##### Hashtags #️⃣ : #devops #docker #linux #automation #ci #github-actions #dokku #java-springboot #nginx

##### English-Version README.Para leer la Versión en Español,ve a README.md

## ✅️ DockerGHA4


![Build Status](https://github.com/Pascua2020/DockerGHA/actions/workflows/main.yml/badge.svg)
![Version](https://img.shields.io/badge/version-1.0.0-blue)
![Docker](https://img.shields.io/badge/container-Docker-blue?logo=docker&logoColor=white)
![GitHub Actions](https://img.shields.io/badge/CI-GitHub%20Actions-blue?logo=githubactions&logoColor=white)
![Dokku](https://img.shields.io/badge/deployment-Dokku-blueviolet?logo=dokku)
![No License](https://img.shields.io/badge/license-None-red) 
![English](https://img.shields.io/badge/language-english-blue?style=flat-square&logo=google-translate)

( Docker, GitHub Actions, Java Spring Boot, and Dokku )

![DevOps Logo](https://globalittrainers.com/wp-content/uploads/2021/06/Devops-logo1.png)

```diff
- This project demonstrates how to integrate Docker, GitHub Actions, Java Spring Boot, and Dokku to create an automated development and deployment workflow.

- The application is a basic Spring Boot service running inside a Docker container, automated with GitHub Actions, and deployed using Dokku.
```

## 1️⃣🟥 Features

#### *⚡️ Docker :*

![Docker Logo](https://dwglogo.com/wp-content/uploads/2017/09/Docker_container_engine_logo.png)

Packages the Spring Boot application in a container to ensure it runs consistently in any environment.

#### *⚡️ GitHub Actions :*

![GHA Logo](https://miro.medium.com/v2/resize:fit:1075/0*w5Fsp29pbWIUpW7Q.png)

Automates the build, test, and deployment processes for the application with each change in the repository.

#### *⚡️ Java Spring Boot :*

![Java SB Logo](https://miro.medium.com/v2/resize:fit:720/format:webp/1*MvUFlFTbiU40ae1SK69-Jg.png)

Backend framework for web application development.

#### *⚡️ Dokku :*

![Dokku Logo](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj6mNvZ4G3tFQpY1qcVDQdWGSVUW5ljKhyUxfgTeFAZUX5r48Xm8M6mMf55h3IkCw1DC3ERygHIWgsvguq1cYntoluBXdW4-7W_Uhw8JHrvQIeW5T1lIGOuk7WTvkP5O-M_XR4J-6W9Gg-vfhG6B-Q6w75EaJ_eHlGvjxcbEGB3_xckw6OnTwxuBWsL-TRQ/s2800/A%20Deep%20Dive%20with%20Dokku.webp)

A Heroku-like deployment platform that uses Docker containers to manage applications easily.

### Differences between DockerGHA 1, 2, 3, and 4 :

#### ⚠️ *All Dockerfiles are identical :*

- Use the base image busybox:latest.

- Copy a run.sh script into the container, which prints the current time in the console in an infinite loop.

- Configure the run.sh script as the container's entry point.


#### ⚠️ *Main.yml - General differences :*

*ℹ️ 1. Repositories :*


- 1 and 2 push images only to Docker Hub.

- 3 pushes only to GHCR.

- 4 pushes to both registries (Docker Hub and GHCR).


*ℹ️ 2. Automation :*

- Repositories 2, 3, and 4 use docker/metadata-action for automatic tagging, while 1 does not.


*ℹ️ 3. Image names :*

- Repository 1 has a fixed name: clockbox:latest.

- The other repositories use dynamic or specific configurations.


## 2️⃣🟧 Project Structure
```
DockerGHA4/
│
├── .github/
│   └── workflows/
│       └── main.yml             # GitHub Actions workflow
├── Dockerfile                   # Dockerfile for containerizing the app
├── README.md                    # Project documentation
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   └── com/
│   │   │       └──  DominioApplication.java   # Spring Boot main class
│   │   └── resources/
│   │       └── application.properties         # App configuration
├── target/                       # Build directory (generated by Maven/Gradle)
├── pom.xml                       # Maven configuration file (if using Maven)
└── .gitignore                    # Files and directories to ignore in Git
```
#### *💾 Dockerfile :*

Defines how to build the Docker image for the Spring Boot project.

#### *💾 main.yml :*

GitHub Actions configuration file to automate building, testing, and deployment.

#### *💾 src/ :*

Contains the source code for the Spring Boot application.

#### *💾 pom.xml :*

Maven configuration file for dependencies and project build.

#### *💾 dokku-deploy.sh :*

Script that automates the deployment process of the application to a remote server using Dokku.

## 3️⃣🟩 Objectives of the Project

The purpose of this repository is to demonstrate the use of Docker, GitHub Actions, and Dokku in a unified DevOps workflow for building, testing, and deploying applications.

This workflow is highly modular and follows standard practices to ensure scalability and automation:

Containerize the application using Docker.

Implement CI/CD pipelines using GitHub Actions.

Automate deployment processes via Dokku.

## 4️⃣🟨 Technologies Used

#### ▫️ *Backend :*

💡Java Spring Boot : Provides a framework for developing microservices and REST APIs.

#### ▫️ *Containers :*

💡Docker : Used to create, deploy, and run the application in containers, ensuring consistency across environments.

#### ▫️ *Automation :*

💡GitHub Actions : Configured to automate the build, test, and deployment processes.

#### ▫️ *Deployment :*

💡Dokku : Used to manage and deploy the application to a virtualized environment, simplifying application hosting.

#### ▫️ *Others :*

💡Nginx : Used as a reverse proxy for the application to enhance performance and security.

## ⬜️ Code

#### 💡 *Dockerfile*
```
# syntax=docker/dockerfile:1
FROM busybox:latest
COPY --chmod=755 <<EOF /app/run.sh
#!/bin/sh
while true; do
  echo -ne "The time is now $(date +%T)\\r"
  sleep 1
done
EOF

ENTRYPOINT /app/run.sh
```

This Dockerfile creates a minimal Docker image that runs a simple script displaying the current time in an infinite loop.

*🔷️ 1. Base Image :*

FROM busybox:latest: Uses the lightweight busybox image as the base for the container.

*🔷️ 2. Script Creation :*

The COPY --chmod=755 <<EOF /app/run.sh command writes a script directly into the /app/run.sh file inside the container with executable permissions.

The script does the following:

Starts an infinite loop (while true).

Prints the current time in the format HH:MM:SS using the date +%T command.

Refreshes the output in place (\\r), overwriting the previous time.

Waits for 1 second (sleep 1) before repeating.

*🔷️ 3. Entry Point :*

ENTRYPOINT /app/run.sh: Sets /app/run.sh as the command to be executed when the container starts.

### *🔑 Result :*
When the container is run, it continuously displays the current time in the console, updating every second.

#### 💡 *Main.yml*
```
name: Publish Docker image

on:
  push:
    branches: ['main']

jobs:
  push_to_registries:
    name: Push Docker image to multiple registries
    runs-on: ubuntu-latest
    permissions:
      packages: write
      contents: read
    steps:
      - name: Check out the repo
        uses: actions/checkout@v4

      - name: Log in to Docker Hub
        uses: docker/login-action@f4ef78c080cd8ba55a85445d5b36e214a81df20a
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Log in to the Container registry
        uses: docker/login-action@65b78e6e13532edd9afa3aa52ac7964289d1a9c1
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Extract metadata (tags, labels) for Docker
        id: meta
        uses: docker/metadata-action@9ec57ed1fcdbf14dcef7dfbe97b2010124a938b7
        with:
          images: |
            my-docker-hub-namespace/my-docker-hub-repository
            ghcr.io/${{ github.repository }}
      
      - name: Build and push Docker images
        uses: docker/build-push-action@3b5e8027fcad23fda98b2e3ac259d8d67585f671
        with:
          context: .
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
```

This GitHub Actions workflow automates the process of building and publishing a Docker image to multiple registries. Here's a step-by-step explanation:

*🔷️ Workflow Name*

name: Publish Docker image: This workflow is named "Publish Docker image."

*🔷️ Trigger*

on: push: The workflow is triggered whenever a change is pushed to the main branch.

*🔷️ Job Details*

Job Name

push_to_registries: The job is called "Push Docker image to multiple registries."

Environment

runs-on: ubuntu-latest: The job runs on the latest Ubuntu environment.

permissions:

packages: write: Grants permission to write to container registries.

contents: read: Grants read access to repository content.

*🔷️ Steps*

▫️ 1. Check out the repository

actions/checkout@v4: Clones the repository to the workflow environment.

▫️ 2. Log in to Docker Hub

Uses the docker/login-action to authenticate with Docker Hub.

Credentials (username and password) are securely retrieved from secrets.DOCKER_USERNAME and secrets.DOCKER_PASSWORD.

▫️ 3. Log in to GitHub Container Registry

Uses the docker/login-action to log in to the GitHub Container Registry (ghcr.io).

Authentication is done with the current GitHub actor and GITHUB_TOKEN.

▫️ 4. Extract Metadata

docker/metadata-action: Generates tags and labels for the Docker images.

Images are specified as:

my-docker-hub-namespace/my-docker-hub-repository: For Docker Hub.

ghcr.io/${{ github.repository }}: For GitHub Container Registry.

▫️ 5. Build and Push Docker Images

docker/build-push-action: Builds the Docker images using the repository's Dockerfile and pushes them to the specified registries.

Metadata (tags and labels) generated in the previous step are applied to the images.

### *🔑 Outcome*

Docker images are built from the repository's Dockerfile and published to both:

1. Docker Hub.

2. GitHub Container Registry.

This allows you to store and share the image across multiple platforms seamlessly.

## 5️⃣🟦 Project Status

```
☑️ Completed.
```

## 6️⃣👤 Collaboration

This project is for personal use and is not open to external contributions.
However, if you find it interesting or have any questions, I’ll be happy to hear them! Feel free to contact me on my GitHub profile.

## 7️⃣🟪 License

This project does not have an assigned license. Without an explicit license, all rights are reserved. If you wish to use this project, please contact me.

## 8️⃣🟫 Authors

- *Pascua2020* (https://github.com/Pascua2020)

- *UTN*


## 9️⃣📒 Official Documentation :

*- Docker :*
https://docs.docker.com

*- GitHub Actions :*
https://docs.github.com/en/actions

*- Dokku :*
https://dokku.com/docs/getting-started/installation/

## 🔟🔄 Notes

🍪 *Security Considerations*

- This project uses secret variables (DOCKER_USERNAME, DOCKER_PASSWORD, GITHUB_TOKEN).

- Make sure to configure the secrets in the "Settings > Secrets and Variables > Actions" section of your repository.


🍪 *Project Limitations*

- This project does not include advanced orchestration setups like Kubernetes.

- It is designed for simple deployments in Docker-compatible environments.


🍪 *Additional Notes*

- This project is an educational example. 

- It is not recommended for use in production environments without making specific adjustments.
